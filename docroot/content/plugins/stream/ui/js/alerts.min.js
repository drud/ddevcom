jQuery(function(o){"use strict";function c(t){var e=o(t);e.find(".select2-select.connector_or_context").each(function(t,e){o(e).select2({allowClear:!0,placeholder:streamAlerts.anyContext,templateResult:function(t){return void 0===t.id?t.text:-1===t.id.indexOf("-")?o('<span class="parent">'+t.text+"</span>"):o('<span class="child">'+t.text+"</span>")},matcher:function(t,e){var n=o.extend(!0,{},e);if(null===t.term||""===o.trim(t.term))return n;var a=t.term.toLowerCase();if(n.id=n.id.replace("blogs","sites"),0<=n.id.toLowerCase().indexOf(a))return n;if(n.children){for(var i=n.children.length-1;0<=i;i--){-1===n.children[i].id.toLowerCase().indexOf(a)&&n.children.splice(i,1)}if(0<n.children.length)return n}return null}}).change(function(){var t,e=o(this).val();e&&(t=e.split("-"),o(this).siblings(".connector").val(t[0]),o(this).siblings(".context").val(t[1]))});var n=[o(e).siblings(".connector").val(),o(e).siblings(".context").val()];""===n[1]&&n.splice(1,1),o(e).val(n.join("-")).trigger("change")}),e.find("select.select2-select:not(.connector_or_context)").each(function(){var t=o(this).attr("id").split("_"),e=t[t.length-1].charAt(0).toUpperCase()+t[t.length-1].slice(1);o(this).select2({allowClear:!0,placeholder:streamAlerts.any+" "+e})})}function i(t){var e={action:"load_alerts_settings",alert_type:t},n=o("#wp_stream_alert_type").closest("tr").attr("id");e.post_id=n.split("-")[1],o.post(window.ajaxurl,e,function(t){var e=o("#wp_stream_alert_type_form");"none"!==o("#wp_stream_alert_type").val()?(e.html(t.data.html),e.show()):e.hide()})}var p,_,t=o("#wp_stream_alert_type");o("#the-list").on("change","#wp_stream_trigger_connector_or_context",function(){var t;"wp_stream_trigger_connector_or_context"===o(this).attr("id")&&((t=o(this).val())&&0<t.indexOf("-")&&(t=t.split("-")[0]),e(t))});var e=function(t){var s=o("#wp_stream_trigger_action");s.empty(),s.prop("disabled",!0);var e=o("<option/>",{value:"",text:""});s.append(e);var n={action:"get_actions",connector:t};o.post(window.ajaxurl,n,function(t){var e,n,a=t.success,i=t.data;if(a){for(var r in i){i.hasOwnProperty(r)&&(e=i[r],n=o("<option/>",{value:r,text:e}),s.append(n))}s.prop("disabled",!1),o(document).trigger("alert-actions-updated")}})};t.change(function(){i(o(this).val())}),o("#wpbody-content").on("click","a.page-title-action",function(t){t.preventDefault(),o("#add-new-alert").remove(),0<o(".inline-edit-wp_stream_alerts").length&&o(".inline-edit-wp_stream_alerts .inline-edit-save button.button-secondary.cancel").trigger("click");var a;o.post(window.ajaxurl,{action:"get_new_alert_triggers_notifications"},function(t){var e,n;!0===t.success&&(a=t.data.html,o("tbody#the-list").prepend('<tr id="add-new-alert" class="inline-edit-row inline-edit-row-page inline-edit-page quick-edit-row quick-edit-row-page inline-edit-page inline-editor" style=""><td colspan="4" class="colspanchange">'+a+'<p class="submit inline-edit-save"> <button type="button" class="button-secondary cancel alignleft">Cancel</button> <input type="hidden" id="_inline_edit" name="_inline_edit" value="3550d271fe"> <button type="button" class="button-primary save alignright">Save</button> <span class="spinner"></span><span class="error" style="display:none"></span> <br class="clear"></p></td></tr>'),e=o("#add-new-alert"),n=e.css("background-color"),e.css("background-color","#C1E1B9"),setTimeout(function(){e.css("background-color",n)},250),o("#wp_stream_alert_type").change(function(){i(o(this).val())}),e.on("click",".button-secondary.cancel",function(){o("#add-new-alert").remove()}),e.on("click",".button-primary.save",r),c("#add-new-alert"))})});var n,a,r=function(t){t.preventDefault(),o("#add-new-alert").find("p.submit.inline-edit-save span.spinner").css("visibility","visible");var e={action:"save_new_alert",wp_stream_alerts_nonce:o("#wp_stream_alerts_nonce").val(),wp_stream_trigger_author:o("#wp_stream_trigger_author").val(),wp_stream_trigger_context:o("#wp_stream_trigger_connector_or_context").val(),wp_stream_trigger_action:o("#wp_stream_trigger_action").val(),wp_stream_alert_type:o("#wp_stream_alert_type").val(),wp_stream_alert_status:o("#wp_stream_alert_status").val()};o("#wp_stream_alert_type_form").find(":input").each(function(){var t=o(this).attr("id");o(this).val()&&(e[t]=o(this).val())}),o.post(window.ajaxurl,e,function(t){!0===t.success&&(o("#add-new-alert").find("p.submit.inline-edit-save span.spinner").css("visibility","hidden"),location.reload())})},d=inlineEditPost.edit;inlineEditPost.edit=function(t){d.apply(this,arguments);var e,n,a,i,r,s,l=0;"object"==typeof t&&(l=parseInt(this.getId(t),10)),0<l&&(_=o("#edit-"+l),a=(e=(p=o("#post-"+l)).find('input[name="wp_stream_trigger_connector"]').val())+"-"+(n=p.find('input[name="wp_stream_trigger_context"]').val()),i=p.find('input[name="wp_stream_trigger_action"]').val(),r=p.find('input[name="wp_stream_alert_status"]').val(),_.find('input[name="wp_stream_trigger_connector"]').attr("value",e),_.find('input[name="wp_stream_trigger_context"]').attr("value",n),_.find('select[name="wp_stream_trigger_connector_or_context"] option[value="'+a+'"]').attr("selected","selected"),o(document).one("alert-actions-updated",function(){_.find('input[name="wp_stream_trigger_action"]').attr("value",i),_.find('select[name="wp_stream_trigger_action"] option[value="'+i+'"]').attr("selected","selected").trigger("change")}),_.find('select[name="wp_stream_alert_status"] option[value="'+r+'"]').attr("selected","selected"),c("#edit-"+l),o("#wp_stream_alert_type_form").hide(),s=p.find('input[name="wp_stream_alert_type"]').val(),_.find('select[name="wp_stream_alert_type"] option[value="'+s+'"]').attr("selected","selected").trigger("change"))},!window.location.hash||(n=o(window.location.hash)).length&&(a=n.offset().top-o("#wpadminbar").height(),o("html, body").animate({scrollTop:a},1e3),n.find(".row-actions a.editinline").trigger("click"))});