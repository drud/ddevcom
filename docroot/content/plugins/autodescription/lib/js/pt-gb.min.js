'use strict';window.tsfPTGB=function(a){const b="undefined"!=typeof tsfPTL10n&&tsfPTL10n,{addFilter:c}=wp.hooks,{createElement:d,Fragment:e}=wp.element,{SelectControl:f}=wp.components,{addQueryArgs:g}=wp.url,h=wp.apiFetch,{invoke:i,unescape:j}=lodash,k={per_page:-1,orderby:"id",order:"asc",_fields:"id,name"},l=()=>{if(!Object.keys(b.taxonomies).length)return;let l=b.taxonomies,m=wp.template("tsf-primary-term-selector"),n={};const o=(a,b)=>b in l[a].i18n&&l[a].i18n[b]||"",p=a=>document.getElementById(`autodescription[_primary_term_${a}]`),q=a=>+p(a).value,r=(a,b)=>+(p(a).value=+b),s=b=>{let c=document.getElementById("tsf-gutenberg-data-holder");if(!c)return n[b]=!1;let d=m({taxonomy:l[b]});return n[b]=!!a(d).appendTo(c)},t=a=>n[a],u=(a,b)=>{0>b.indexOf(q(a))&&(0 in b?r(a,b[0]):r(a,0))};var v={};class w{constructor(a){this.slug=a,this.reset()}registeredData(){return!!Object.keys(this.data).length}reset(){this.data={}}read(){return this.data}get(a){return a in this.data&&this.data[a]||null}set(a,b){return this.data[a]=b}}const x=a=>v[a]=new w(a),y=a=>v[a]||x(a);class z extends React.Component{componentDidMount(){this.dsAccess().registeredData()||this.registerData(),this.dsAccess().registeredData()&&(this.hasNewTerms()?this.fetchTerms():this.setState({loading:!1}))}componentWillUnmount(){i(this.fetchRequest,["abort"])}componentDidUpdate(a){a.terms===this.props.terms||1<this.props.terms.length&&(!this.dsAccess().get("availableTerms")||this.hasNewTerms())&&this.fetchTerms()}registerData(){this.dsAccess().set("availableTerms",[]),this.fetchTerms()}dsAccess(){return y(this.props.slug)}hasNewTerms(){let a=(this.dsAccess().get("availableTerms")||[]).map(a=>a.id);return!this.props.terms.every(b=>a.includes(b))}isTermAvailable(a){return this.dsAccess().get("availableTerms").some(b=>b.id===a)}fetchTerms(){const{taxonomy:a}=this.props;a&&(this.setState({loading:!0}),this.fetchRequest=h({path:g(`/wp/v2/${a.rest_base}`,k)}),this.fetchRequest.then(a=>{this.fetchRequest=null,this.setState({loading:!1}),this.dsAccess().set("availableTerms",a),this.forceUpdate()},a=>{"abort"===a.statusText||(this.fetchRequest=null,this.setState({loading:!1}))}))}}class A extends z{constructor(){super(...arguments),this.onChange=this.onChange.bind(this),this.state={loading:!0}}getTermName(a){let b=this.dsAccess().get("availableTerms");if(!Array.isArray(b))return"";let c=b.find(b=>b.id===a);return c&&c.name||""}getSelectOptions(){return Array.isArray(this.props.terms)?this.props.terms.sort().map(a=>({value:a,label:j(this.getTermName(a))})):""}onChange(a){this.setState({options:this.getSelectOptions(),value:r(this.props.slug,a)}),"tsfAys"in window&&tsfAys.registerChange()}isDisabled(){if(this.state.loading||!Array.isArray(this.props.terms))return!0;let a=this.dsAccess().get("availableTerms");return!Array.isArray(a)||!a.length}render(){return d(f,{label:o(this.props.slug,"selectPrimary"),value:q(this.props.slug),className:"tsf-pt-gb-selector",onChange:this.onChange,options:this.getSelectOptions(),disabled:this.isDisabled()})}}const B=a=>class extends React.Component{initSelectors(){const{slug:a,terms:b}=this.props;return t(a)&&(u(a,b),1<b.length)?d(e,{},d(A,this.props)):null}render(){return this.props.slug in l?d(e,{},d(a,this.props),this.initSelectors()):d(a,this.props)}};(()=>{for(let a in l)s(a);c("editor.PostTaxonomyType","tsf/pt",B,20)})()};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",l)}},{},{l10n:b})}(jQuery),window.tsfPTGB.load();
